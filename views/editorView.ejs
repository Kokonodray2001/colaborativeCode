<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://bootswatch.com/5/slate/bootstrap.min.css"
    />
    <script src="https://cdn.socket.io/socket.io-3.0.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.3.4/axios.min.js"></script>
    <title>Code Editor</title>
  </head>
  <body>
  
  
    <div class="container" style="display: flex; margin: 10px; width: 100%;">
      <div class="sidebar" style="width: 200px;">
        <label style="display: inline;"><h3><i class="fa-solid fa-users"></i> Users</h3></label>
        <table class="table table-striped table-responsive" id="userTable">
          <% users.forEach(element => { %>
            <tr>
            <td> <%=element.name%> </td>  
            </tr>
        <%  }); %>
          <!-- <tr>
            <td><i class="fa-sharp fa-solid fa-user"></i>  User1</td>
          </tr>
          <tr>
            <td><i class="fa-sharp fa-solid fa-user"></i>  User2</td>
          </tr>
          <tr>
            <td><i class="fa-sharp fa-solid fa-user"></i>  User3</td>
          </tr> -->
        </table>
        <select class="form-select" aria-label="Default select example">
          <option selected>Open this select menu</option>
          <option value="1">One</option>
          <option value="2">Two</option>
          <option value="3">Three</option>
        </select>
         
        <button type="button" class="btn btn-success" fdprocessedid="ab1lrr" style="margin-top:600px ;">Copy Id</button>
       <!-- <a href="http://localhost:5000"> <button type="button" id="leave-room" class="btn btn-danger" fdprocessedid="g0xmm6"  >Leave Room</button></a>  -->
       <button type="button" id="leave-room" class="btn btn-danger" fdprocessedid="g0xmm6"  >Leave Room</button>  
      </div>
      <div class="editor" style=" margin-left: 10%; width: 100%;">
        <label style="display: flex ; align-items: center; background-color: black;"><h3>-Editor-<i class="fa-solid fa-code"></i></h3></label>
        
        <textarea class="form-control rounded-0" id="Code" rows="40" 
         style="font-family: monospace; background-color: #343333; color: azure;"></textarea>
      </div>
       
      <script>
        //local storage 
        localStorage.setItem('roomID','hi');
        console.log(localStorage.getItem('roomID'));

        // getting room id and username in browser
        const roomId = '<%= roomId %>';
        const userName = '<%= userName %>';

        const socket =  io('http://localhost:3000')
       
        var myTextArea =  document.getElementById('Code');
        var btnLeave =  document.getElementById('leave-room');

        socket.on("connect",()=>{//  client connecting to a room
          var id =  socket.id;
          
       
        //  joinng  a coustom room
          socket.emit('join-room',roomId,userName);

        //  adding user
         socket.on('add-user',(userName)=>{
          const table = document.getElementById('userTable');
          
            var trow =  document.createElement('tr');
            var tdata =  document.createElement('td');
            tdata.textContent = userName;
            trow.appendChild(tdata);
            table.appendChild(trow);
          
          })
           //receving the message emited from the server 
        socket.on('recived-message',(message)=>{
          myTextArea.value = message;
         })

         //removing users
          socket.on('remove-user',(user)=>{
            const table =  document.getElementById('userTable');
            console.log('removed');
            //updating the table 
            var rowcount =  table.rows.length;
            for(var i = rowcount-1 ;i >=0;i--)
              table.deleteRow(i);
            user.forEach(element => {
              
            var trow =  document.createElement('tr');
            var tdata =  document.createElement('td');
            tdata.textContent = element.name;
            trow.appendChild(tdata);
            table.appendChild(trow);

            });
           // console.log(user);


          })
         })

         myTextArea.addEventListener('input', () => {
          //console.log('Textarea input changed!');
           //  sending message to the server
          socket.emit('send-message',roomId,myTextArea.value);
        });
       
         //disconnect
         btnLeave.addEventListener('click',()=>{
          console.log('clicked');
          socket.emit('userDisconnect',roomId,userName);
          window.location.href = "/";
        })

    </script>
      
  </body>
</html>
